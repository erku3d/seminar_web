<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>Matrixmultiplikation</title>
    <script type="text/javascript">

        window.onload = function(e) {
            document.getElementById("mat_A").placeholder = "1,2,3\n4,5,6\n7,8,9";
            document.getElementById("mat_B").placeholder = "1,2,3\n4,5,6\n7,8,9";
        };

        function textareaToMatrix(id){
            //Matrix A

            var str = document.getElementById(id).value.trim();

            if(str.length == 0)
                throw "is empty";

            //erzeuge Array aus den Zeilen
			var rows = str.split("\n");

			var mat = [];
            var row_len;

			for (i = 0; i < rows.length; i++){

                //in jeder Zeile sind die einzelnen Werte durch "," getrennt
                var row = rows[i].split(",");

                //jede Zeile der Matrix muss die gleiche Anzahl an Elementen haben
                if(i==0){
                    row_len = row.length;
                } else {
                    if (row.length != row_len){
                        throw "rows unevenly";
                    }
                }
                //entfernt Leerzeichen etc. von den einzelnen Elementen
                //TODO prüfen, ob das notwendig ist
                for(j=0; j<row.length; j++)
                    row[j] = row[j].trim();

				mat.push(row);
			}
            return mat;
        }

		function sendRequest(){
            
            try{
                var mat_A = textareaToMatrix("mat_A");
            }
            catch(err){
                switch(err) {
                    case "is empty":
                        alert("Matrix A ist leer!");
                        return;

                    case "rows unevenly":
                        alert("Zeilenlängen der Matrix A sind ungleich!");
                        return;

                    default:
                        alert("Fehler: "+err);
                        return;
                }
            }

            try{
                var mat_B = textareaToMatrix("mat_B");
            }
            catch(err){
                switch(err) {
                    case "is empty":
                        alert("Matrix B ist leer!");
                        return;

                    case "rows unevenly":
                        alert("Zeilenlängen der Matrix B sind ungleich!");
                        return;

                    default:
                        alert("Fehler: "+err);
                        return;
                }
            }
			
			
			
			var op = document.getElementById("operation").value;
			
			if(op == "add" || op == "diff"){
				//addition, subtraktion -> A und B gleiche größe
				if((mat_A.length != mat_B.length) || (mat_A[0].length != mat_B[0].length)){
					alert("Beide Matrizen müssen dieselbe größe haben.");
					return;
				}
			} else { //mul
				//Mulltipikation ->  #spalten A = #Zeilen B
				if(mat_A[0].length != mat_B.length){
					alert("Spaltenanzhal von A muss gleich der Zeilenanzahl von B sein");
					return;
				}
			}
			
			//erzeuge http request body
			
			var body = '{"op":"'+op+'",';
			body = body + '"mat_A": ' + JSON.stringify(mat_A) +',';
			body = body + '"mat_B": ' + JSON.stringify(mat_B) +'}';			
			

			alert(body);

		}
    </script>
  </head>
  <body>
    <table> 
        <tr align="center">
            <td>A</td>
            <td></td>
            <td>B</td>
            <td></td>
            <td>C</td>
        </tr>
        <tr>
            <td><textarea id="mat_A" rows="5" cols="10" autocomplete="off" wrap="off"></textarea></td>
            <td>
				<select id="operation">
				  <option value="add">+</option>
				  <option value="diff">-</option>
				  <option value="mull" selected>&#149;</option>
				</select>
			</td>
            <td><textarea id="mat_B" rows="5" cols="10" autocomplete="off" wrap="off" ></textarea></td>
            <td>=</td>
            <td><textarea id="mat_c" rows="5" cols="10" autocomplete="off" wrap="off" readonly ></textarea></td>
        </tr>
        <tr>
            <td><button type="button" id="btn" onclick="sendRequest()" >berechnen</button></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>
  </body>
</html>
